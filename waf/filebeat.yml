###########################
# Filebeat for Caddy + WAF
###########################

path.data: /var/lib/filebeat
path.logs: /var/log/filebeat

# ================================
# INPUT: Caddy + WAF JSON logs
# ================================
filebeat.inputs:
  - type: filestream
    id: caddy-waf-input
    enabled: true

    # Percorsi dei log di Caddy e del WAF
    paths:
      - /var/log/caddy/waf_*.log
      - /var/log/caddy/access_*.log

    # Parsing JSON nativo
    parsers:
      - ndjson:
          target: ""

    # Campi extra
    fields:
      app: caddy-waf
      environment: production
    fields_under_root: true

    ignore_older: 24h
    scan_frequency: 10s
    close_inactive: 5m

# ================================
# MODULI (disattivati)
# ================================
filebeat.config.modules:
  path: ${path.config}/modules.d/*.yml
  reload.enabled: false

# ================================
# OUTPUT: SYSLOG verso SIEM 
# ================================
output.syslog:
  enabled: true
  host: "10.246.50.82"
  port: 6515
  protocol: "tcp"
  format: "rfc5424"
  app_name: "filebeat-caddy"
  facility: "local0"
  severity: "info"

# ================================
# PROCESSORS
# ================================
processors:
  - add_host_metadata: ~
  - add_cloud_metadata: ~
  - add_process_metadata: ~
  - timestamp:
      field: "@timestamp"
      layouts:
        - ISO8601

# ================================
# LOGGING LOCALE DI FILEBEAT
# ================================
logging.level: info
logging.to_files: true
logging.files:
  path: /var/log/filebeat
  name: filebeat
  keepfiles: 7
  permissions: 0644
