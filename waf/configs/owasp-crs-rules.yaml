# =========================================
# OWASP Core Rule Set (CRS) - Complete Rules
# Based on OWASP ModSecurity CRS v4.x
# =========================================

version: "4.0"
description: "Complete OWASP CRS rules for comprehensive web application protection"

# =========================================
# XSS (Cross-Site Scripting) Detection
# Rule IDs: 941000-941999
# =========================================
xss_rules:
  - id: 941100
    name: "XSS Attack Detected via libinjection"
    description: "Cross-site Scripting (XSS) detected"
    severity: CRITICAL
    category: "attack-xss"
    patterns:
      - <script[^>]*>
      - </script>
      - <script[\s/\\]+
      - javascript:
      - vbscript:
      - livescript:
      - data:text/javascript
    enabled: true
    actions:
      - block
      - log
      - alert

  - id: 941110
    name: "XSS Filter - Category 1: Script Tag Vector"
    description: "Script tag based XSS vectors"
    severity: CRITICAL
    category: "attack-xss"
    patterns:
      - (?i)<script[^>]*>[^<]*<\/script>
      - (?i)<script[^>]*src
      - (?i)<script[^>]*>
    enabled: true
    actions:
      - block
      - log

  - id: 941120
    name: "XSS Filter - Category 2: Event Handler Vector"
    description: "Event handler based XSS vectors"
    severity: HIGH
    category: "attack-xss"
    patterns:
      - (?i)on\w+\s*=
      - (?i)onload\s*=
      - (?i)onerror\s*=
      - (?i)onclick\s*=
      - (?i)onmouseover\s*=
      - (?i)onmouseout\s*=
      - (?i)onfocus\s*=
      - (?i)onblur\s*=
      - (?i)onchange\s*=
      - (?i)onsubmit\s*=
    enabled: true
    actions:
      - block
      - log

  - id: 941130
    name: "XSS Filter - Category 3: Attribute/Style Vector"
    description: "Style attribute XSS vectors"
    severity: HIGH
    category: "attack-xss"
    patterns:
      - (?i)style\s*=.*?expression\s*\(
      - (?i)style\s*=.*?javascript:
      - (?i)style\s*=.*?@import
      - (?i)style\s*=.*?behavior:
      - (?i)-moz-binding:
    enabled: true
    actions:
      - block
      - log

  - id: 941140
    name: "XSS Filter - Category 4: JavaScript URI Vector"
    description: "JavaScript URI based XSS"
    severity: HIGH
    category: "attack-xss"
    patterns:
      - (?i)javascript:
      - (?i)vbscript:
      - (?i)data:text/html
      - (?i)data:application/javascript
    enabled: true
    actions:
      - block
      - log

  - id: 941150
    name: "XSS Filter - Category 5: Disallowed HTML Attributes"
    description: "Dangerous HTML attributes"
    severity: MEDIUM
    category: "attack-xss"
    patterns:
      - (?i)<iframe
      - (?i)<object
      - (?i)<embed
      - (?i)<applet
      - (?i)<meta
      - (?i)<link
      - (?i)<base
    enabled: true
    actions:
      - block
      - log

  - id: 941160
    name: "XSS Filter - Category 6: UTF-7/8 Encoding"
    description: "UTF encoding based XSS"
    severity: HIGH
    category: "attack-xss"
    patterns:
      - "&#[0-9]+;"
      - "&#x[0-9a-f]+;"
      - "\\\\x[0-9a-f]{2}"
      - "\\\\u[0-9a-f]{4}"
    enabled: true
    actions:
      - block
      - log

  - id: 941170
    name: "XSS Filter - Category 7: JavaScript Method Calls"
    description: "Dangerous JavaScript functions"
    severity: HIGH
    category: "attack-xss"
    patterns:
      - (?i)eval\s*\(
      - (?i)alert\s*\(
      - (?i)prompt\s*\(
      - (?i)confirm\s*\(
      - (?i)document\.write
      - (?i)document\.cookie
      - (?i)window\.location
    enabled: true
    actions:
      - block
      - log

  - id: 941180
    name: "XSS Filter - Category 8: SVG/XML Vectors"
    description: "SVG and XML based XSS"
    severity: HIGH
    category: "attack-xss"
    patterns:
      - (?i)<svg[^>]*onload
      - (?i)<svg[^>]*onerror
      - (?i)<img[^>]*onerror
      - (?i)<img[^>]*onload
      - (?i)<animatetransform
    enabled: true
    actions:
      - block
      - log

  - id: 941190
    name: "XSS Filter - Category 9: Template Injection"
    description: "Template injection attempts"
    severity: HIGH
    category: "attack-xss"
    patterns:
      - "\\{\\{.*?\\}\\}"
      - "<%.*?%>"
      - "\\$\\{.*?\\}"
    enabled: true
    actions:
      - block
      - log

# =========================================
# SQL Injection Detection
# Rule IDs: 942000-942999
# =========================================
sqli_rules:
  - id: 942100
    name: "SQL Injection Attack Detected via libinjection"
    description: "SQL Injection detected"
    severity: CRITICAL
    category: "attack-sqli"
    patterns:
      - (?i)union\s+(all\s+)?select
      - (?i)' or '
      - (?i)or 1=1
      - (?i)' or 1=1
    enabled: true
    actions:
      - block
      - log
      - alert

  - id: 942110
    name: "SQL Injection Attack: Common Injection Testing Detected"
    description: "Boolean-based SQL injection"
    severity: CRITICAL
    category: "attack-sqli"
    patterns:
      - (?i)\b(or|and)\s*['"]?\s*\d+\s*=\s*\d+['"]?
      - (?i)\b(or|and)\s*['"]1['"]\s*=\s*['"]1['"]\s*
      - (?i)'\s*or\s*'
      - (?i)"\s*or\s*"
      - (?i)'\s*and\s*'
    enabled: true
    actions:
      - block
      - log

  - id: 942120
    name: "SQL Injection Attack: SQL Operator Detected"
    description: "SQL operators in injection"
    severity: CRITICAL
    category: "attack-sqli"
    patterns:
      - (?i)union\s+select
      - (?i)union\s+all\s+select
      - (?i)union.*from
      - (?i)select.*from
      - (?i)insert.*into
      - (?i)update.*set
      - (?i)delete.*from
    enabled: true
    actions:
      - block
      - log

  - id: 942130
    name: "SQL Injection Attack: SQL Tautology Detected"
    description: "Tautology-based SQL injection"
    severity: CRITICAL
    category: "attack-sqli"
    patterns:
      - (?i)or\s+1\s*=\s*1
      - (?i)and\s+1\s*=\s*1
      - (?i)or\s+true
      - (?i)and\s+true
      - (?i)'\s*=\s*'
    enabled: true
    actions:
      - block
      - log

  - id: 942140
    name: "SQL Injection Attack: Common DB Names Detected"
    description: "Database schema enumeration"
    severity: HIGH
    category: "attack-sqli"
    patterns:
      - (?i)information_schema
      - (?i)mysql\.user
      - (?i)pg_catalog
      - (?i)sys\.databases
      - (?i)all_tables
      - (?i)user_tables
    enabled: true
    actions:
      - block
      - log

  - id: 942150
    name: "SQL Injection Attack: Blind SQLi Testing Detected"
    description: "Blind SQL injection attempts"
    severity: CRITICAL
    category: "attack-sqli"
    patterns:
      - (?i)sleep\s*\(
      - (?i)benchmark\s*\(
      - (?i)waitfor\s+delay
      - (?i)pg_sleep\s*\(
    enabled: true
    actions:
      - block
      - log

  - id: 942160
    name: "SQL Injection Attack: SQL Functions Detected"
    description: "SQL string manipulation functions"
    severity: HIGH
    category: "attack-sqli"
    patterns:
      - (?i)concat\s*\(
      - (?i)char\s*\(
      - (?i)ascii\s*\(
      - (?i)substring\s*\(
      - (?i)group_concat\s*\(
    enabled: true
    actions:
      - block
      - log

  - id: 942170
    name: "SQL Injection Attack: Stored Procedure Detected"
    description: "Dangerous stored procedures"
    severity: CRITICAL
    category: "attack-sqli"
    patterns:
      - (?i)xp_cmdshell
      - (?i)sp_executesql
      - (?i)exec\s+master
      - (?i)execute\s+immediate
    enabled: true
    actions:
      - block
      - log

  - id: 942180
    name: "SQL Injection Attack: SQL Comment Detected"
    description: "SQL comment sequences"
    severity: HIGH
    category: "attack-sqli"
    patterns:
      - "--"
      - "#"
      - "/\\*.*?\\*/"
      - "'.*?--"
      - "\".*?--"
    enabled: true
    actions:
      - block
      - log

  - id: 942190
    name: "SQL Injection Attack: Stacked Queries Detected"
    description: "Semicolon-separated queries"
    severity: CRITICAL
    category: "attack-sqli"
    patterns:
      - (?i);\s*(drop|delete|update|insert|create|alter|exec)
      - (?i);\s*shutdown
    enabled: true
    actions:
      - block
      - log

  - id: 942200
    name: "SQL Injection Attack: Error-Based SQLi"
    description: "Error-based SQL injection functions"
    severity: HIGH
    category: "attack-sqli"
    patterns:
      - (?i)extractvalue\s*\(
      - (?i)updatexml\s*\(
      - (?i)exp\s*\(
      - (?i)floor\s*\(.*?rand\s*\(
    enabled: true
    actions:
      - block
      - log

# =========================================
# Command Injection Detection
# Rule IDs: 932000-932999
# =========================================
command_injection_rules:
  - id: 932100
    name: "Remote Command Execution: Unix Command Injection"
    description: "Unix/Linux command injection detected"
    severity: CRITICAL
    category: "attack-rce"
    patterns:
      - (?i);\s*(ls|cat|pwd|whoami|id|uname)
      - (?i)\|\s*(ls|cat|pwd|whoami|id|uname)
      - (?i)&&\s*(ls|cat|pwd|whoami|id|uname)
      - (?i)\|\|\s*(ls|cat|pwd|whoami|id|uname)
    enabled: true
    actions:
      - block
      - log
      - alert

  - id: 932110
    name: "Remote Command Execution: Windows Command Injection"
    description: "Windows command injection detected"
    severity: CRITICAL
    category: "attack-rce"
    patterns:
      - (?i)cmd\.exe
      - (?i)cmd\s+/c
      - (?i)powershell\.exe
      - (?i)powershell\s+-
    enabled: true
    actions:
      - block
      - log

  - id: 932120
    name: "Remote Command Execution: Shell Invocation"
    description: "Shell command execution detected"
    severity: CRITICAL
    category: "attack-rce"
    patterns:
      - (?i)/bin/(bash|sh|dash|zsh)
      - (?i)bash\s+-c
      - (?i)sh\s+-c
    enabled: true
    actions:
      - block
      - log

  - id: 932130
    name: "Remote Command Execution: Command Substitution"
    description: "Command substitution patterns"
    severity: CRITICAL
    category: "attack-rce"
    patterns:
      - "\\$\\(.*?\\)"
      - "`.*?`"
      - "\\$\\{.*?\\}"
    enabled: true
    actions:
      - block
      - log

  - id: 932140
    name: "Remote Command Execution: Network Commands"
    description: "Network-based command injection"
    severity: CRITICAL
    category: "attack-rce"
    patterns:
      - (?i)\b(wget|curl|nc|netcat|telnet)\s+
      - (?i)wget\s+http
      - (?i)curl\s+http
    enabled: true
    actions:
      - block
      - log

  - id: 932150
    name: "Remote Command Execution: File Operations"
    description: "Dangerous file operations"
    severity: HIGH
    category: "attack-rce"
    patterns:
      - (?i)rm\s+-rf
      - (?i)chmod\s+[0-7]{3,4}
      - (?i)chown\s+(root|www-data)
    enabled: true
    actions:
      - block
      - log

  - id: 932160
    name: "Remote Command Execution: Reverse Shell"
    description: "Reverse shell attempts"
    severity: CRITICAL
    category: "attack-rce"
    patterns:
      - (?i)/dev/(tcp|udp)/
      - (?i)bash\s+-i
      - (?i)nc\s+.*\s+-e
      - (?i)mkfifo
    enabled: true
    actions:
      - block
      - log

# =========================================
# Local File Inclusion (LFI) Detection
# Rule IDs: 930000-930999
# =========================================
lfi_rules:
  - id: 930100
    name: "Path Traversal Attack (/../)"
    description: "Directory traversal detected"
    severity: CRITICAL
    category: "attack-lfi"
    patterns:
      - \\.\\./
      - \\.\\./\\.\\./
      - \\.\\.\\/\\.\\.\\/
    enabled: true
    actions:
      - block
      - log
      - alert

  - id: 930110
    name: "Path Traversal Attack: URL-Encoded"
    description: "Encoded directory traversal"
    severity: CRITICAL
    category: "attack-lfi"
    patterns:
      - "%2e%2e/"
      - "%2e%2e%2f"
      - "%252e%252e/"
      - "%c0%ae%c0%ae/"
    enabled: true
    actions:
      - block
      - log

  - id: 930120
    name: "OS File Access Attempt"
    description: "Sensitive file access attempt"
    severity: CRITICAL
    category: "attack-lfi"
    patterns:
      - /etc/passwd
      - /etc/shadow
      - /etc/hosts
      - /proc/self/environ
      - (?i)c:\\\\windows
      - (?i)boot\\.ini
      - (?i)win\\.ini
    enabled: true
    actions:
      - block
      - log

  - id: 930130
    name: "Restricted File Access Attempt"
    description: "Web application sensitive files"
    severity: HIGH
    category: "attack-lfi"
    patterns:
      - (?i)\\.env
      - (?i)\\.git/config
      - (?i)\\.htaccess
      - (?i)web\\.config
      - (?i)wp-config\\.php
    enabled: true
    actions:
      - block
      - log

  - id: 930140
    name: "PHP Wrapper Attack"
    description: "PHP stream wrapper usage"
    severity: CRITICAL
    category: "attack-lfi"
    patterns:
      - (?i)php://filter
      - (?i)php://input
      - (?i)php://output
      - (?i)expect://
      - (?i)phar://
    enabled: true
    actions:
      - block
      - log

# =========================================
# Remote File Inclusion (RFI) Detection
# Rule IDs: 931000-931999
# =========================================
rfi_rules:
  - id: 931100
    name: "Possible Remote File Inclusion (RFI) Attack: URL Parameter"
    description: "RFI via URL parameter"
    severity: CRITICAL
    category: "attack-rfi"
    patterns:
      - (?i)https?://
      - (?i)ftp://
      - (?i)ftps://
    enabled: true
    actions:
      - block
      - log
      - alert

  - id: 931110
    name: "Possible Remote File Inclusion (RFI) Attack: Common RFI Parameter"
    description: "Common RFI vulnerable parameters"
    severity: CRITICAL
    category: "attack-rfi"
    patterns:
      - (?i)(page|file|document|folder|root|path|pg)=.*?https?://
      - (?i)(include|require|template)=.*?https?://
    enabled: true
    actions:
      - block
      - log

  - id: 931120
    name: "Possible Remote File Inclusion (RFI) Attack: SSRF"
    description: "Server-Side Request Forgery"
    severity: CRITICAL
    category: "attack-rfi"
    patterns:
      - (?i)https?://localhost
      - (?i)https?://127\\.0\\.0\\.1
      - (?i)https?://169\\.254\\.169\\.254
      - (?i)https?://10\\.
      - (?i)https?://192\\.168\\.
    enabled: true
    actions:
      - block
      - log

  - id: 931130
    name: "Possible Remote File Inclusion (RFI) Attack: Cloud Metadata"
    description: "Cloud metadata service access"
    severity: CRITICAL
    category: "attack-rfi"
    patterns:
      - (?i)metadata\\.google\\.internal
      - (?i)metadata\\.azure\\.com
      - (?i)169\\.254\\.169\\.254
    enabled: true
    actions:
      - block
      - log

# =========================================
# Protocol Attack Detection
# Rule IDs: 920000-920999
# =========================================
protocol_attack_rules:
  - id: 920100
    name: "Invalid HTTP Request Line"
    description: "Malformed HTTP request"
    severity: HIGH
    category: "attack-protocol"
    patterns:
      - "^[^A-Z]"
    enabled: true
    actions:
      - block
      - log

  - id: 920110
    name: "Invalid HTTP Method"
    description: "Non-standard HTTP method"
    severity: MEDIUM
    category: "attack-protocol"
    patterns:
      - "(?i)^(TRACK|TRACE|DEBUG|OPTIONS|CONNECT)"
    enabled: true
    actions:
      - block
      - log

  - id: 920120
    name: "Request Containing Content but Missing Content-Type Header"
    description: "Missing Content-Type header"
    severity: LOW
    category: "attack-protocol"
    enabled: true
    actions:
      - log

  - id: 920130
    name: "Failed to Parse Request Body"
    description: "Request body parsing error"
    severity: MEDIUM
    category: "attack-protocol"
    enabled: true
    actions:
      - block
      - log

  - id: 920140
    name: "Multipart Request Body Failed Strict Validation"
    description: "Multipart parsing issues"
    severity: MEDIUM
    category: "attack-protocol"
    enabled: true
    actions:
      - block
      - log

  - id: 920150
    name: "HTTP Header Injection Attack"
    description: "CRLF injection in headers"
    severity: HIGH
    category: "attack-protocol"
    patterns:
      - "\\r\\n"
      - "%0d%0a"
      - "\\n"
      - "%0a"
    enabled: true
    actions:
      - block
      - log

# =========================================
# Session Fixation Detection
# Rule IDs: 943000-943999
# =========================================
session_fixation_rules:
  - id: 943100
    name: "Possible Session Fixation Attack: Setting Session ID in Parameter"
    description: "Session fixation detected"
    severity: HIGH
    category: "attack-session"
    patterns:
      - (?i)(PHPSESSID|JSESSIONID|ASPSESSIONID|ASP\\.NET_SessionId)
    enabled: true
    actions:
      - block
      - log

  - id: 943110
    name: "Session Fixation: SessionID in URL"
    description: "Session ID exposed in URL"
    severity: MEDIUM
    category: "attack-session"
    patterns:
      - (?i)(sessionid|session_id|sid)=
    enabled: true
    actions:
      - log

# =========================================
# Scanner/Bot Detection
# Rule IDs: 913000-913999
# =========================================
scanner_detection_rules:
  - id: 913100
    name: "Found User-Agent Associated with Security Scanner"
    description: "Security scanner detected"
    severity: LOW
    category: "scanner-detection"
    patterns:
      - (?i)(nikto|sqlmap|nmap|acunetix|netsparker|burp|w3af|metasploit)
      - (?i)(nessus|openvas|qualys|nexpose|appscan|webinspect)
      - (?i)(zap|arachni|wfuzz|dirb|gobuster|dirbuster)
    enabled: true
    actions:
      - block
      - log

  - id: 913110
    name: "Found User-Agent Associated with Web Crawler"
    description: "Web crawler detected"
    severity: LOW
    category: "scanner-detection"
    patterns:
      - (?i)(bot|crawler|spider|scraper)
      - (?i)(wget|curl|libwww)
    enabled: false
    actions:
      - log

  - id: 913120
    name: "Anomaly Score Exceeded"
    description: "Total anomaly score too high"
    severity: CRITICAL
    category: "anomaly"
    enabled: true
    actions:
      - block
      - log
      - alert

# =========================================
# Rate Limiting & DoS Protection
# Rule IDs: 912000-912999
# =========================================
rate_limiting_rules:
  - id: 912100
    name: "DoS Attack Identified"
    description: "Denial of Service attack pattern"
    severity: CRITICAL
    category: "attack-dos"
    enabled: true
    actions:
      - block
      - log

  - id: 912110
    name: "Rate Limit Exceeded"
    description: "Too many requests from single IP"
    severity: HIGH
    category: "rate-limit"
    enabled: true
    actions:
      - block
      - log

# =========================================
# XXE (XML External Entity) Detection
# Rule IDs: 950000-950999
# =========================================
xxe_rules:
  - id: 950100
    name: "XXE Attack: External Entity Declaration"
    description: "XML External Entity attack detected"
    severity: CRITICAL
    category: "attack-xxe"
    patterns:
      - (?i)<!ENTITY
      - (?i)<!DOCTYPE.*ENTITY
      - (?i)SYSTEM\s+["']file://
      - (?i)SYSTEM\s+["']http://
    enabled: true
    actions:
      - block
      - log
      - alert

  - id: 950110
    name: "XXE Attack: Entity Expansion (Billion Laughs)"
    description: "XML bomb / billion laughs attack"
    severity: HIGH
    category: "attack-xxe"
    patterns:
      - (?i)<!ENTITY.*&.*&.*>
      - (?i)<!ENTITY.*<!ENTITY
    enabled: true
    actions:
      - block
      - log

  - id: 950120
    name: "XXE Attack: XInclude"
    description: "XXE via XInclude"
    severity: HIGH
    category: "attack-xxe"
    patterns:
      - (?i)<xi:include
      - (?i)xmlns:xi
    enabled: true
    actions:
      - block
      - log

# =========================================
# SSRF (Server-Side Request Forgery) Detection
# Rule IDs: 951000-951999
# =========================================
ssrf_rules:
  - id: 951100
    name: "SSRF Attack: Localhost Access"
    description: "SSRF attempt to localhost"
    severity: CRITICAL
    category: "attack-ssrf"
    patterns:
      - (?i)https?://localhost
      - (?i)https?://127\.0\.0\.1
      - (?i)https?://0\.0\.0\.0
      - (?i)https?://\[::1\]
    enabled: true
    actions:
      - block
      - log
      - alert

  - id: 951110
    name: "SSRF Attack: Private IP Range"
    description: "SSRF to private IP ranges"
    severity: CRITICAL
    category: "attack-ssrf"
    patterns:
      - (?i)https?://10\.
      - (?i)https?://172\.(1[6-9]|2[0-9]|3[0-1])\.
      - (?i)https?://192\.168\.
    enabled: true
    actions:
      - block
      - log

  - id: 951120
    name: "SSRF Attack: Cloud Metadata"
    description: "Access to cloud metadata services"
    severity: CRITICAL
    category: "attack-ssrf"
    patterns:
      - (?i)169\.254\.169\.254
      - (?i)metadata\.google\.internal
      - (?i)metadata\.azure\.com
    enabled: true
    actions:
      - block
      - log
      - alert

# =========================================
# NoSQL Injection Detection
# Rule IDs: 952000-952999
# =========================================
nosql_rules:
  - id: 952100
    name: "NoSQL Injection: MongoDB Operators"
    description: "MongoDB operator injection"
    severity: CRITICAL
    category: "attack-nosql"
    patterns:
      - (?i)\$where
      - (?i)\$ne
      - (?i)\$gt
      - (?i)\$regex
      - (?i)\$or
      - (?i)\$and
    enabled: true
    actions:
      - block
      - log
      - alert

  - id: 952110
    name: "NoSQL Injection: Authentication Bypass"
    description: "NoSQL authentication bypass attempt"
    severity: CRITICAL
    category: "attack-nosql"
    patterns:
      - (?i)\{"?\$ne"?\s*:\s*null\}
      - (?i)\{"?\$gt"?\s*:\s*""\}
    enabled: true
    actions:
      - block
      - log

# =========================================
# LDAP Injection Detection
# Rule IDs: 953000-953999
# =========================================
ldap_rules:
  - id: 953100
    name: "LDAP Injection: Filter Injection"
    description: "LDAP filter injection attack"
    severity: HIGH
    category: "attack-ldap"
    patterns:
      - \*\)\(
      - \)\(
      - \*\|
      - \|\(
    enabled: true
    actions:
      - block
      - log

  - id: 953110
    name: "LDAP Injection: Authentication Bypass"
    description: "LDAP authentication bypass"
    severity: HIGH
    category: "attack-ldap"
    patterns:
      - \*\)\(&
      - \*\)\(\|
      - admin\*
    enabled: true
    actions:
      - block
      - log

# =========================================
# SSTI (Server-Side Template Injection) Detection
# Rule IDs: 954000-954999
# =========================================
ssti_rules:
  - id: 954100
    name: "SSTI Attack: Template Expression"
    description: "Server-side template injection"
    severity: CRITICAL
    category: "attack-ssti"
    patterns:
      - \{\{.*?\}\}
      - \{\%.*?\%\}
      - \$\{.*?\}
    enabled: true
    actions:
      - block
      - log
      - alert

  - id: 954110
    name: "SSTI Attack: Python Template Injection"
    description: "Python-based template injection (Jinja2, etc.)"
    severity: CRITICAL
    category: "attack-ssti"
    patterns:
      - \{\{.*__class__.*\}\}
      - \{\{.*__mro__.*\}\}
      - \{\{.*__subclasses__.*\}\}
      - \{\{.*__globals__.*\}\}
    enabled: true
    actions:
      - block
      - log
      - alert

  - id: 954120
    name: "SSTI Attack: Ruby ERB Injection"
    description: "Ruby ERB template injection"
    severity: CRITICAL
    category: "attack-ssti"
    patterns:
      - <%.*%>
      - <%=.*%>
      - <%.*system.*%>
      - <%.*eval.*%>
    enabled: true
    actions:
      - block
      - log

# =========================================
# HTTP Response Splitting Detection
# Rule IDs: 955000-955999
# =========================================
response_splitting_rules:
  - id: 955100
    name: "HTTP Response Splitting: CRLF Injection"
    description: "CRLF injection / Response splitting"
    severity: HIGH
    category: "attack-response-splitting"
    patterns:
      - "%0d%0a"
      - "%0D%0A"
      - "\\r\\n"
    enabled: true
    actions:
      - block
      - log

  - id: 955110
    name: "HTTP Response Splitting: Header Injection"
    description: "HTTP header injection attempt"
    severity: HIGH
    category: "attack-response-splitting"
    patterns:
      - (?i)\r\nSet-Cookie:
      - (?i)%0d%0aSet-Cookie:
      - (?i)\r\nLocation:
      - (?i)%0d%0aLocation:
    enabled: true
    actions:
      - block
      - log

# =========================================
# Prototype Pollution Detection
# Rule IDs: 956000-956999
# =========================================
prototype_pollution_rules:
  - id: 956100
    name: "Prototype Pollution: __proto__ Access"
    description: "Prototype pollution via __proto__"
    severity: HIGH
    category: "attack-prototype"
    patterns:
      - __proto__
      - __PROTO__
      - \["__proto__"\]
      - \['__proto__'\]
    enabled: true
    actions:
      - block
      - log

  - id: 956110
    name: "Prototype Pollution: Constructor.prototype"
    description: "Prototype pollution via constructor"
    severity: HIGH
    category: "attack-prototype"
    patterns:
      - constructor\.prototype
      - constructor\["prototype"\]
      - constructor\['prototype'\]
    enabled: true
    actions:
      - block
      - log

# =========================================
# Path Traversal Detection (Advanced)
# Rule IDs: 957000-957999
# =========================================
path_traversal_rules:
  - id: 957100
    name: "Path Traversal: Directory Traversal"
    description: "Advanced path traversal attack"
    severity: HIGH
    category: "attack-path-traversal"
    patterns:
      - \\.\\./
      - \\.\\./\\.\\./
      - %2e%2e/
      - %2e%2e%2f
    enabled: true
    actions:
      - block
      - log
      - alert

  - id: 957110
    name: "Path Traversal: Encoded Traversal"
    description: "Encoded path traversal"
    severity: HIGH
    category: "attack-path-traversal"
    patterns:
      - %252e%252e/
      - %c0%ae%c0%ae/
      - %u002e%u002e/
    enabled: true
    actions:
      - block
      - log

  - id: 957120
    name: "Path Traversal: Null Byte Injection"
    description: "Path traversal with null byte"
    severity: HIGH
    category: "attack-path-traversal"
    patterns:
      - "%00"
      - "\\x00"
      - \\.\\./.*%00
    enabled: true
    actions:
      - block
      - log
