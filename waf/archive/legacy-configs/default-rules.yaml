# =========================================
# Default WAF Rules - Production Ready
# Based on OWASP Top 10 + Common Attack Patterns
# =========================================

# === XSS (Cross-Site Scripting) ===
- id: xss-001
  name: Script Tag Injection
  description: Detects basic script tag injection
  severity: CRITICAL
  category: attack-xss
  patterns:
    - (?i)<script[^>]*>
    - (?i)</script>
    - (?i)<script[\s/\\]+
  enabled: true
  actions:
    - block
    - log
    - alert

- id: xss-002
  name: JavaScript Protocol Handler
  description: Detects javascript: protocol in URLs
  severity: HIGH
  category: attack-xss
  patterns:
    - (?i)javascript:
    - (?i)vbscript:
    - (?i)livescript:
  enabled: true
  actions:
    - block
    - log

- id: xss-003
  name: Event Handler Injection
  description: Detects inline event handlers
  severity: HIGH
  category: attack-xss
  patterns:
    - (?i)onload\s*=
    - (?i)onerror\s*=
    - (?i)onclick\s*=
    - (?i)onmouseover\s*=
    - (?i)onfocus\s*=
  enabled: true
  actions:
    - block
    - log

- id: xss-004
  name: Dangerous HTML Tags
  description: Detects dangerous HTML tags
  severity: HIGH
  category: attack-xss
  patterns:
    - (?i)<iframe
    - (?i)<object
    - (?i)<embed
    - (?i)<applet
  enabled: true
  actions:
    - block
    - log

- id: xss-005
  name: SVG-Based XSS
  description: Detects SVG-based XSS vectors
  severity: HIGH
  category: attack-xss
  patterns:
    - (?i)<svg[^>]*onload
    - (?i)<svg[^>]*onerror
  enabled: true
  actions:
    - block
    - log

# === SQL Injection ===
- id: sqli-001
  name: Union-Based SQL Injection
  description: Detects UNION SELECT statements
  severity: CRITICAL
  category: attack-sqli
  patterns:
    - (?i)union\s+(all\s+)?select
    - (?i)union.*from
  enabled: true
  actions:
    - block
    - log
    - alert

- id: sqli-002
  name: Boolean-Based SQL Injection
  description: Detects boolean-based SQL injection
  severity: CRITICAL
  category: attack-sqli
  patterns:
    - (?i)'\s*or\s*'1'\s*=\s*'1
    - (?i)"\s*or\s*"1"\s*=\s*"1
    - (?i)or\s+1\s*=\s*1
    - (?i)'\s*or\s*'
  enabled: true
  actions:
    - block
    - log
    - alert

- id: sqli-003
  name: SQL Comment Injection
  description: Detects SQL comment sequences
  severity: HIGH
  category: attack-sqli
  patterns:
    - --
    - /\*
    - \*/
    - "#"
  enabled: true
  actions:
    - block
    - log

- id: sqli-004
  name: Time-Based Blind SQL Injection
  description: Detects time-based blind SQLi
  severity: CRITICAL
  category: attack-sqli
  patterns:
    - (?i)sleep\s*\(
    - (?i)benchmark\s*\(
    - (?i)waitfor\s+delay
  enabled: true
  actions:
    - block
    - log

- id: sqli-005
  name: Information Schema Access
  description: Detects database schema enumeration
  severity: HIGH
  category: attack-sqli
  patterns:
    - (?i)information_schema
    - (?i)mysql\.user
    - (?i)pg_catalog
  enabled: true
  actions:
    - block
    - log

# === Command Injection ===
- id: cmdi-001
  name: Unix Command Injection
  description: Detects Unix command injection
  severity: CRITICAL
  category: attack-rce
  patterns:
    - (?i);\s*(ls|cat|pwd|whoami|id|uname)
    - (?i)\|\s*(ls|cat|pwd|whoami|id)
    - (?i)&&\s*(ls|cat|pwd|whoami)
  enabled: true
  actions:
    - block
    - log
    - alert

- id: cmdi-002
  name: Windows Command Injection
  description: Detects Windows command injection
  severity: CRITICAL
  category: attack-rce
  patterns:
    - (?i)cmd\.exe
    - (?i)cmd\s+/c
    - (?i)powershell\.exe
  enabled: true
  actions:
    - block
    - log

- id: cmdi-003
  name: Command Substitution
  description: Detects command substitution patterns
  severity: CRITICAL
  category: attack-rce
  patterns:
    - \$\(.*?\)
    - "`.*?`"
  enabled: true
  actions:
    - block
    - log

- id: cmdi-004
  name: Reverse Shell Attempts
  description: Detects reverse shell patterns
  severity: CRITICAL
  category: attack-rce
  patterns:
    - (?i)/dev/(tcp|udp)/
    - (?i)bash\s+-i
    - (?i)nc\s+.*\s+-e
  enabled: true
  actions:
    - block
    - log
    - alert

# === Local File Inclusion (LFI) ===
- id: lfi-001
  name: Path Traversal
  description: Detects directory traversal attempts
  severity: CRITICAL
  category: attack-lfi
  patterns:
    - \\.\\./
    - \\.\\./\\.\\./
  enabled: true
  actions:
    - block
    - log
    - alert

- id: lfi-002
  name: Sensitive File Access
  description: Detects sensitive file access attempts
  severity: CRITICAL
  category: attack-lfi
  patterns:
    - /etc/passwd
    - /etc/shadow
    - (?i)c:\\windows
    - (?i)boot\.ini
  enabled: true
  actions:
    - block
    - log

- id: lfi-003
  name: PHP Wrapper Exploitation
  description: Detects PHP wrapper usage
  severity: CRITICAL
  category: attack-lfi
  patterns:
    - (?i)php://filter
    - (?i)php://input
    - (?i)expect://
  enabled: true
  actions:
    - block
    - log

- id: lfi-004
  name: Web Config File Access
  description: Detects attempts to access config files
  severity: HIGH
  category: attack-lfi
  patterns:
    - (?i)\.env
    - (?i)\.git/config
    - (?i)web\.config
    - (?i)wp-config\.php
  enabled: true
  actions:
    - block
    - log

# === Remote File Inclusion (RFI) ===
- id: rfi-001
  name: Remote URL Inclusion
  description: Detects remote URL in parameters
  severity: CRITICAL
  category: attack-rfi
  patterns:
    - (?i)https?://
    - (?i)ftp://
  enabled: true
  actions:
    - block
    - log
    - alert

- id: rfi-002
  name: SSRF via Localhost
  description: Detects SSRF attempts to localhost
  severity: CRITICAL
  category: attack-ssrf
  patterns:
    - (?i)https?://localhost
    - (?i)https?://127\.0\.0\.1
    - (?i)https?://0\.0\.0\.0
  enabled: true
  actions:
    - block
    - log

- id: rfi-003
  name: Cloud Metadata Access
  description: Detects cloud metadata service access
  severity: CRITICAL
  category: attack-ssrf
  patterns:
    - (?i)169\.254\.169\.254
    - (?i)metadata\.google\.internal
    - (?i)metadata\.azure\.com
  enabled: true
  actions:
    - block
    - log
    - alert

# === XXE (XML External Entity) ===
- id: xxe-001
  name: XML External Entity
  description: Detects XXE attack patterns
  severity: CRITICAL
  category: attack-xxe
  patterns:
    - (?i)<!ENTITY
    - (?i)<!DOCTYPE.*ENTITY
    - (?i)SYSTEM\s+["']file://
  enabled: true
  actions:
    - block
    - log
    - alert

- id: xxe-002
  name: XML Entity Expansion
  description: Detects entity expansion attacks
  severity: HIGH
  category: attack-xxe
  patterns:
    - (?i)<!ENTITY.*&.*>
  enabled: true
  actions:
    - block
    - log

# === LDAP Injection ===
- id: ldap-001
  name: LDAP Injection
  description: Detects LDAP injection patterns
  severity: HIGH
  category: attack-ldap
  patterns:
    - \*\)\(
    - \)\(
    - \*\|
  enabled: true
  actions:
    - block
    - log

# === NoSQL Injection ===
- id: nosql-001
  name: MongoDB Injection
  description: Detects MongoDB injection patterns
  severity: CRITICAL
  category: attack-nosql
  patterns:
    - (?i)\$where
    - (?i)\$ne
    - (?i)\$gt
    - (?i)\$regex
  enabled: true
  actions:
    - block
    - log

# === SSTI (Server-Side Template Injection) ===
- id: ssti-001
  name: Template Injection
  description: Detects template injection patterns
  severity: CRITICAL
  category: attack-ssti
  patterns:
    - \{\{.*?\}\}
    - \{\%.*?\%\}
    - \$\{.*?\}
  enabled: true
  actions:
    - block
    - log
    - alert

# === HTTP Response Splitting ===
- id: http-001
  name: CRLF Injection
  description: Detects CRLF injection (Response Splitting)
  severity: HIGH
  category: attack-http
  patterns:
    - "%0d%0a"
    - "%0a"
    - "\\r\\n"
    - "\\n"
  enabled: true
  actions:
    - block
    - log

# === Scanner Detection ===
- id: scanner-001
  name: Security Scanner Detection
  description: Detects common security scanners
  severity: LOW
  category: scanner-detection
  patterns:
    - (?i)nikto
    - (?i)sqlmap
    - (?i)nmap
    - (?i)acunetix
    - (?i)burp
    - (?i)metasploit
  enabled: true
  actions:
    - block
    - log

# === Prototype Pollution ===
- id: proto-001
  name: Prototype Pollution
  description: Detects prototype pollution attempts
  severity: HIGH
  category: attack-prototype
  patterns:
    - __proto__
    - constructor\.prototype
    - prototype\.
  enabled: true
  actions:
    - block
    - log
